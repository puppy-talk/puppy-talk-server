# Development Dockerfile with hot reloading
FROM openjdk:21-jdk-slim

# Install necessary tools for development
RUN apt-get update && apt-get install -y \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy Gradle wrapper and build files
COPY gradlew .
COPY gradle/ gradle/
COPY build.gradle .
COPY settings.gradle .

# Make gradlew executable
RUN chmod +x ./gradlew

# Copy source code
COPY . .

# Pre-download dependencies for faster startup
RUN ./gradlew dependencies --no-daemon || true

# Expose ports
EXPOSE 8080 35729

# Create logs directory
RUN mkdir -p /app/logs

# Development JVM options
ENV JAVA_OPTS="-XX:+UseContainerSupport \
               -XX:MaxRAMPercentage=75.0 \
               -XX:+UseG1GC \
               -Djava.security.egd=file:/dev/./urandom \
               -Dspring.devtools.restart.enabled=true \
               -Dspring.devtools.livereload.enabled=true"

# Default command for development
CMD ["./gradlew", "bootRun", "--continuous"]